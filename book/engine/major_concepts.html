<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Major concepts</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="../mermaid.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../what_is_chalk.html"><strong aria-hidden="true">1.</strong> What is Chalk?</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../what_is_chalk/walkthrough.html"><strong aria-hidden="true">1.1.</strong> Walkthrough</a></li><li class="chapter-item expanded "><a href="../what_is_chalk/crates.html"><strong aria-hidden="true">1.2.</strong> Crates</a></li><li class="chapter-item expanded "><a href="../what_is_chalk/repl.html"><strong aria-hidden="true">1.3.</strong> REPL</a></li></ol></li><li class="chapter-item expanded "><a href="../contribution_guide.html"><strong aria-hidden="true">2.</strong> Contribution guide</a></li><li class="chapter-item expanded "><a href="../types.html"><strong aria-hidden="true">3.</strong> Representing and manipulating types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../types/role_of_interner.html"><strong aria-hidden="true">3.1.</strong> The Interner</a></li><li class="chapter-item expanded "><a href="../types/rust_types.html"><strong aria-hidden="true">3.2.</strong> Rust types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../types/rust_types/application_ty.html"><strong aria-hidden="true">3.2.1.</strong> Application types</a></li></ol></li><li class="chapter-item expanded "><a href="../types/rust_lifetimes.html"><strong aria-hidden="true">3.3.</strong> Rust lifetimes</a></li><li class="chapter-item expanded "><a href="../types/operations.html"><strong aria-hidden="true">3.4.</strong> Operations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../types/operations/fold.html"><strong aria-hidden="true">3.4.1.</strong> Fold and the Folder trait</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../clauses.html"><strong aria-hidden="true">4.</strong> Lowering Rust IR to logic</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../clauses/goals_and_clauses.html"><strong aria-hidden="true">4.1.</strong> Goals and clauses</a></li><li class="chapter-item expanded "><a href="../clauses/type_equality.html"><strong aria-hidden="true">4.2.</strong> Type equality and unification</a></li><li class="chapter-item expanded "><a href="../clauses/implied_bounds.html"><strong aria-hidden="true">4.3.</strong> Implied bounds</a></li><li class="chapter-item expanded "><a href="../clauses/lowering_rules.html"><strong aria-hidden="true">4.4.</strong> Lowering rules</a></li><li class="chapter-item expanded "><a href="../clauses/well_known_traits.html"><strong aria-hidden="true">4.5.</strong> Well known traits</a></li><li class="chapter-item expanded "><a href="../clauses/wf.html"><strong aria-hidden="true">4.6.</strong> Well-formedness checking</a></li></ol></li><li class="chapter-item expanded "><a href="../canonical_queries.html"><strong aria-hidden="true">5.</strong> Canonical queries</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../canonical_queries/canonicalization.html"><strong aria-hidden="true">5.1.</strong> Canonicalization</a></li></ol></li><li class="chapter-item expanded "><a href="../engine.html"><strong aria-hidden="true">6.</strong> Chalk engine</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../engine/major_concepts.html" class="active"><strong aria-hidden="true">6.1.</strong> Major concepts</a></li><li class="chapter-item expanded "><a href="../engine/logic.html"><strong aria-hidden="true">6.2.</strong> Logic</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../engine/logic/coinduction.html"><strong aria-hidden="true">6.2.1.</strong> Coinduction</a></li></ol></li><li class="chapter-item expanded "><a href="../engine/slg.html"><strong aria-hidden="true">6.3.</strong> SLG Solver</a></li></ol></li><li class="chapter-item expanded "><a href="../recursive.html"><strong aria-hidden="true">7.</strong> Chalk recursive solver</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../recursive/stack.html"><strong aria-hidden="true">7.1.</strong> The stack</a></li><li class="chapter-item expanded "><a href="../recursive/inductive_cycles.html"><strong aria-hidden="true">7.2.</strong> Inductive cycles</a></li><li class="chapter-item expanded "><a href="../recursive/search_graph.html"><strong aria-hidden="true">7.3.</strong> The search graph and caching</a></li><li class="chapter-item expanded "><a href="../recursive/coinduction.html"><strong aria-hidden="true">7.4.</strong> Coinduction</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../glossary.html">Appendix A: Glossary and terminology</a></li><li class="chapter-item expanded affix "><a href="../bibliography.html">Appendix B: Bibliography</a></li><li class="chapter-item expanded affix "><a href="../todo.html">Appendix C: Incomplete chapters</a></li><li class="chapter-item expanded affix "><a href="../publishing.html">Appendix D: Publishing Chalk</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#major-concepts" id="major-concepts">Major concepts</a></h1>
<p>This section goes over a few different concepts that are crucial to
understanding how <code>chalk-engine</code> works, without going over the exact solving
logic.</p>
<h2><a class="header" href="#context-contextops-and-inferencetable" id="context-contextops-and-inferencetable"><code>Context</code>, <code>ContextOps</code>, and <code>InferenceTable</code></a></h2>
<h3><a class="header" href="#context" id="context"><code>Context</code></a></h3>
<p>The <a href="https://rust-lang.github.io/chalk/chalk_engine/context/trait.Context.html"><code>Context</code></a> trait is the primary bridge between Chalk internal logic and
external types. In addition actually <em>defining</em> the types (via associated
types), it also contains associated functions to convert or extract
information from those types. Overall, this allows the types to be basically
opaque to the engine internals. Functions in the trait are agnostic to specific
program or environment details, since they lack a <code>&amp;self</code> argument.</p>
<p>To give an example, there is an associated <a href="https://rust-lang.github.io/chalk/chalk_engine/context/trait.Context.html#associatedtype.Goal"><code>Goal</code></a> type. However, Chalk doesn't
know how to solve this. Instead, it has to be converted an <code>HhGoal</code> via the
<code>Context::into_hh_goal</code> function. This will be coverted more in the <code>Goals</code>
section.</p>
<h3><a class="header" href="#contextops" id="contextops"><code>ContextOps</code></a></h3>
<p>The <a href="https://rust-lang.github.io/chalk/chalk_engine/context/trait.ContextOps.html"><code>ContextOps</code></a> trait contains functions that may specifically require
information a specific program or environment. For example, the
<code>program_clauses</code> function gives potential ways to prove a <code>Goal</code>, but obviously
it requires knowing the program (for example, what types, traits, and impls
there are). Functions in this trait all take a <code>&amp;self</code> argument.</p>
<h3><a class="header" href="#inferencetable" id="inferencetable"><code>InferenceTable</code></a></h3>
<p>The <a href="https://rust-lang.github.io/chalk/chalk_engine/context/trait.InferenceTable.html"><code>InferenceTable</code></a> is a super trait to the <a href="https://rust-lang.github.io/chalk/chalk_engine/context/trait.UnificationOps.html"><code>UnificationOps</code></a>, <a href="https://rust-lang.github.io/chalk/chalk_engine/context/trait.TruncateOps.html"><code>TruncateOps</code></a>,
and <a href="https://rust-lang.github.io/chalk/chalk_engine/context/trait.ResolventOps.html"><code>ResolventOps</code></a>. Each of these contains functions that track the state of
specific parts of the program. Importantly, these operations can dynamically
change the state of the logic itself.</p>
<h2><a class="header" href="#goals" id="goals">Goals</a></h2>
<p>A &quot;goal&quot; in Chalk can be thought of as &quot;something we want to prove&quot;. The engine
itself understands <code>HhGoal</code>s. <code>HHGoal</code>s consist of the most basic logic,
such as introducing Binders (<code>Forall</code> or <code>Exists</code>) or combining goals (<code>All</code>).
On the other hand, <code>Context::Goal</code> represents an opaque goal generated
externally. As such, it may contain any extra information or may be interned.
When solving a logic predicate, Chalk will lazily convert <code>Context::Goal</code>s
into <code>HHGoal</code>s.</p>
<p>There are three types of completely opaque <code>HhGoal</code>s that Chalk can solve:
<code>Unify</code>, <code>DomainGoal</code>, and <code>CannotProve</code>. Unlike the other types of goals,
these three cannot be simiplified any further. <code>Unify</code> is the goal of unifying
any two types. <code>DomainGoal</code> is any goal that can solve by applying a
<a href="https://rust-lang.github.io/chalk/chalk_engine/context/trait.Context.html#associatedtype.ProgramClause"><code>ProgramClause</code></a>. To solve this, more <code>Goal</code>s may generated. Finally,
<code>CannotProve</code> is a special goal that <em>cannot</em> be proven true or false.</p>
<h2><a class="header" href="#answers-and-solutions" id="answers-and-solutions">Answers and Solutions</a></h2>
<p>For every <code>Goal</code>, there are zero or more <code>Answer</code>s. Each <a href="https://rust-lang.github.io/chalk/chalk_engine/struct.Answer.html"><code>Answer</code></a> contains
values for the inference variables in the goal.</p>
<p>For example, given the following program:</p>
<pre><code class="language-notrust">trait Clone {}
struct A {}
struct B {}
impl Clone for A {}
impl Clone for B {}
</code></pre>
<p>With the following goal: <code>exists&lt;T&gt; { T: Clone }</code>
The following solutions would be given:</p>
<pre><code class="language-notrust">T = A
T = B
</code></pre>
<p>In other words, either <code>A</code> or <code>B</code> can substituted for <code>T</code> and the goal will
hold true. Moreover, either answer could be used when further solving other
goals that depend on this goal.</p>
<p>However, oftentimes, this is not what external crates want when solving for a
goal. Instead, the may want a <em>unique</em> solution to this goal. Indeed, when we
solve for a given root <a href="https://rust-lang.github.io/chalk/chalk_engine/context/trait.Context.html#associatedtype.Goal"><code>Goal</code></a>, we return a since <a href="https://rust-lang.github.io/chalk/chalk_engine/context/trait.Context.html#associatedtype.Solution"><code>Solution</code></a>. It is up to the
implementation of <a href="https://rust-lang.github.io/chalk/chalk_engine/context/trait.Context.html"><code>Context</code></a> to decide how a <code>Solution</code> is made, given a possibly
infinite set of answers. One of example of this is the
<a href="https://rust-lang.github.io/chalk/chalk_solve/solve/slg/aggregate/struct.AntiUnifier.html"><code>AntiUnifier</code></a>
from <code>chalk-solve</code>, which finds a minimal generalization of answers which don't
unify. (For the example above, it would return only <code>Ambiguous</code>, since <code>A</code> and
<code>B</code> can't unify.)</p>
<h2><a class="header" href="#exclauses-and-strands" id="exclauses-and-strands">ExClauses and Strands</a></h2>
<p>An <a href="https://rust-lang.github.io/chalk/chalk_engine/struct.ExClause.html"><code>ExClause</code></a> is described in literature as <code>A :- D | G</code> or
<code>A holds given that G holds with D delayed goals</code>. In <code>chalk-engine</code>, an
<code>ExClause</code> stores the current state of proving a goal, including existing
substitutions already found, subgoals yet to be proven, or delayed subgoals. A
<a href="https://rust-lang.github.io/chalk/chalk_engine/strand/struct.Strand.html"><code>Strand</code></a> wraps both an <a href="https://rust-lang.github.io/chalk/chalk_engine/struct.ExClause.html"><code>ExClause</code></a> and an <a href="https://rust-lang.github.io/chalk/chalk_engine/context/trait.InferenceTable.html"><code>InferenceTable</code></a> together. </p>
<h2><a class="header" href="#tables-and-forests" id="tables-and-forests">Tables and Forests</a></h2>
<p>A <a href="https://rust-lang.github.io/chalk/chalk_engine/strand/struct.Strand.html"><code>Strand</code></a> represents a <em>single</em> direction to find an <a href="https://rust-lang.github.io/chalk/chalk_engine/struct.Answer.html"><code>Answer</code></a> - for example, an
implementation of a trait with a set of where clauses. However, in a program,
there may be <em>multiple</em> possible implementations that match a goal - e.g.
multiple impls with different where clauses. Every <a href="https://rust-lang.github.io/chalk/chalk_engine/table/struct.Table.html"><code>Table</code></a> has a goal, and
stores existing <code>Answers</code>, as well as all <code>Strand</code>s that may result in more
answers.</p>
<p>A <a href="https://rust-lang.github.io/chalk/chalk_engine/forest/struct.Forest.html"><code>Forest</code></a> holds all the <code>Table</code>s that program generates, and is what most of
the logic is implemented on. It also stores the current state of solving (the
stack).</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../engine.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../engine/logic.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../engine.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../engine/logic.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="../mermaid.min.js"></script>
        
        <script type="text/javascript" src="../mermaid-init.js"></script>
        

        

    </body>
</html>
